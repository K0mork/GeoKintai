# 実機テスト計画（T-004）

この文書は、シミュレータで代替できない実機依存ケース（特に `T-004`）の検証手順を定義する。  
シミュレータ計画は [simulator_test_plan.md](simulator_test_plan.md) を参照する。

## 1. 対象
- 主対象: `T-004` アプリキル後挙動（`AC-02`）
- 補助対象: 必要に応じて `T-001`, `T-002`, `T-006`, `T-012` の実機再確認

## 2. 事前準備
- 実機（iPhone）を開発端末に接続し、開発者モードを有効化する
- 対象アプリが実機で起動できることを確認する
- 仕事場データを1件以上登録し、対象仕事場の `monitoringEnabled = true` にする
- 位置権限を `Always` にする
- 日時・端末情報・OS バージョンを記録する

## 3. T-004 実施手順（実機）
1. アプリを起動し、仕事場近傍から `Commute_In` 相当の移動を開始する。
2. 入域直後にアプリをタスクスイッチャーから明示的に終了（キル）する。
3. 5分以上の滞在条件を満たす移動を継続する。
4. アプリを再起動し、履歴および現在状態を確認する。
5. 以下を記録する。
   - 勤務開始レコードが作成されたか
   - `entryTime` が妥当か
   - `LocationProof` が保存されているか
   - 異常ログがないか

## 4. 判定基準
- Pass:
  - アプリキル後でも出勤記録が成立する、または仕様どおり保護動作に遷移してユーザー導線が提示される
  - 監査可能な記録（履歴/証拠）が矛盾なく保存される
- Fail:
  - 出勤確定が欠落し、復旧導線も提示されない
  - 履歴・証拠・時刻整合性に矛盾がある

## 5. 記録テンプレート
| ケースID | 実施日 | 実施者 | 端末 | OS | 結果 | 逸脱内容 | 再現手順 |
|---|---|---|---|---|---|---|---|
| T-004 | YYYY-MM-DD | Name | iPhone xx | iOS xx.x | Pass/Fail/Skip | なし/詳細 | 必要時のみ |

## 6. 運用ルール
- 実施ログは `docs/real_device_run_log_YYYY-MM-DD.md` に保存する
- ログ作成は `scripts/new_real_device_log.sh` を利用する
- `T-004` の結果反映時は `simulator_test_plan.md` の結果表も同期更新する
